---
phase: 06-database-cold-calling-client
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - crm-dashboard/supabase/migrations/06_cold_calling_client.sql
  - crm-dashboard/types/lead.ts
  - crm-dashboard/components/ClientAccordion.tsx
autonomous: false

must_haves:
  truths:
    - "User sees 'Cold Calling' in sidebar client list"
    - "Expanding Cold Calling shows only the Leads tab (no Orders, Pipeline, Analytics, Visits)"
    - "Leads table has has_website boolean column"
    - "Leads table has social_media_presence integer column constrained to 1-5"
    - "Existing clients still show all 5 tabs"
  artifacts:
    - path: "crm-dashboard/supabase/migrations/06_cold_calling_client.sql"
      provides: "Schema migration for new columns and Cold Calling client"
      contains: "has_website"
    - path: "crm-dashboard/types/lead.ts"
      provides: "Updated Lead interface with new fields"
      contains: "social_media_presence"
    - path: "crm-dashboard/components/ClientAccordion.tsx"
      provides: "Client-type-aware tab filtering"
      contains: "client_type"
  key_links:
    - from: "crm-dashboard/components/ClientAccordion.tsx"
      to: "clients table"
      via: "Supabase select now includes client_type"
      pattern: "select.*client_type"
    - from: "crm-dashboard/components/ClientAccordion.tsx"
      to: "subNavItems rendering"
      via: "Filter subNavItems based on client_type"
      pattern: "leads_only"
---

# Phase 06 Plan 01: Cold Calling Client + Lead Schema Extension

**One-liner:** Add qualification fields to leads table, create Cold Calling as a leads-only client, and filter sidebar tabs by client type.

<objective>
Create the Cold Calling client as a leads-only view in the CRM sidebar, extend the leads table with qualification fields (has_website, social_media_presence), and add a client_type mechanism so leads-only clients show only the Leads tab.

Purpose: Enable cold-calling workflow where leads are entered manually without needing visits/orders/pipeline infrastructure.
Output: SQL migration file, updated Lead TypeScript interface, updated ClientAccordion with type-aware tab filtering.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@crm-dashboard/components/ClientAccordion.tsx
@crm-dashboard/types/lead.ts
@crm-dashboard/supabase/migrations/05_shrike_consolidation.sql
</context>

<tasks>

<task type="auto">
  <name>Task 1: SQL migration -- lead fields, client_type column, Cold Calling client</name>
  <files>crm-dashboard/supabase/migrations/06_cold_calling_client.sql</files>
  <action>
Create a SQL migration file following the established pattern (see 05_shrike_consolidation.sql for style).

The migration does three things in a single transaction:

1. **Add columns to leads table:**
   - `has_website BOOLEAN DEFAULT NULL` -- nullable, no NOT NULL constraint. Null means "unknown/not assessed yet."
   - `social_media_presence INTEGER DEFAULT NULL CHECK (social_media_presence IS NULL OR (social_media_presence >= 1 AND social_media_presence <= 5))` -- nullable integer 1-5. The CHECK constraint must allow NULL (since it's the default) while constraining non-null values to 1-5.

2. **Add client_type column to clients table:**
   - `client_type TEXT NOT NULL DEFAULT 'full'` -- all existing clients get 'full' automatically via the DEFAULT. Valid values: 'full' (shows all tabs) and 'leads_only' (shows only Leads tab). No CHECK constraint needed -- keep it simple, the UI handles the logic.

3. **Insert Cold Calling client:**
   - `INSERT INTO clients (id, name, slug, is_active, client_type, created_at) VALUES (gen_random_uuid(), 'Cold Calling', 'cold-calling', true, 'leads_only', NOW());`

Wrap everything in `BEGIN; ... COMMIT;`. Add a header comment block explaining the migration purpose (follow the style of 05_shrike_consolidation.sql but keep it concise -- this is a simpler migration).

Run this migration against the Supabase project using the Supabase CLI:
```bash
cd crm-dashboard
npx supabase db push --linked
```

If the Supabase CLI is not installed or not linked, run the SQL directly via the Supabase Management API instead:
```bash
curl -X POST "https://rjudjhjcfivugbyztnce.supabase.co/rest/v1/rpc" \
  -H "apikey: $SUPABASE_ANON_KEY" \
  -H "Authorization: Bearer $SUPABASE_SERVICE_ROLE_KEY" \
  -d '...'
```

If neither CLI nor API approach works, note it as a checkpoint for the user to run the SQL manually via the Supabase SQL Editor (https://supabase.com/dashboard/project/rjudjhjcfivugbyztnce/sql).
  </action>
  <verify>
After migration runs, verify with SQL queries against Supabase:
- `SELECT column_name, data_type, is_nullable FROM information_schema.columns WHERE table_name = 'leads' AND column_name IN ('has_website', 'social_media_presence');` -- both columns exist
- `SELECT column_name, data_type, column_default FROM information_schema.columns WHERE table_name = 'clients' AND column_name = 'client_type';` -- client_type exists with default 'full'
- `SELECT name, slug, client_type FROM clients WHERE slug = 'cold-calling';` -- Cold Calling exists with client_type = 'leads_only'
- `SELECT client_type FROM clients WHERE slug != 'cold-calling' LIMIT 5;` -- all other clients have 'full'
  </verify>
  <done>
leads table has has_website (boolean, nullable) and social_media_presence (integer, nullable, CHECK 1-5) columns. clients table has client_type (text, NOT NULL, default 'full') column. Cold Calling client exists with slug 'cold-calling', is_active true, client_type 'leads_only'. All existing clients have client_type 'full'. Cold Calling starts with zero leads (manual entry form built in Phase 7).
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Lead type and ClientAccordion for client_type awareness</name>
  <files>crm-dashboard/types/lead.ts, crm-dashboard/components/ClientAccordion.tsx</files>
  <action>
**lead.ts changes:**

Add two new optional fields to the `Lead` interface (after `notes` and before `created_at`):
```typescript
has_website: boolean | null
social_media_presence: number | null  // 1-5 scale
```

These are nullable because they default to null in the database and will only be populated for manually-entered cold-calling leads (Phase 7 builds the form).

**ClientAccordion.tsx changes:**

1. Update the `Client` interface to include `client_type`:
```typescript
interface Client {
  id: string
  name: string
  slug: string
  client_type: string  // 'full' | 'leads_only'
}
```

2. Update the Supabase query to fetch `client_type`:
Change `.select('id, name, slug')` to `.select('id, name, slug, client_type')`.

3. Make `subNavItems` filtering client-aware. Delete the `const subNavItems = [...]` declaration (lines 68-74) and replace it with this function in the same location (after `handleNavClick` and before the single-client render branch):

```typescript
const getNavItems = (clientType: string) => {
  const allItems = [
    { path: '/leads', label: 'Leads', icon: 'ðŸ‘¥' },
    { path: '/orders', label: 'Orders', icon: 'ðŸ§¾' },
    { path: '/pipeline', label: 'Pipeline', icon: 'ðŸ“‹' },
    { path: '/analytics', label: 'Analytics', icon: 'ðŸ“Š' },
    { path: '/visits', label: 'Visits', icon: 'ðŸ‘ï¸' },
  ]
  if (clientType === 'leads_only') {
    return allItems.filter(item => item.path === '/leads')
  }
  return allItems
}
```

4. In the single-client simplified view (`!isAdmin && clients.length === 1` branch, ~line 84), replace `subNavItems.map(...)` with `getNavItems(client.client_type).map(...)`.

5. In the multi-client accordion render loop (`clients.map` block, ~line 146), replace `subNavItems.map(...)` with `getNavItems(client.client_type).map(...)`. This means Cold Calling renders only the Leads tab, while all other clients render all 5. The `max-h-64` on the expanded div is a ceiling, not fixed â€” no change needed.
  </action>
  <verify>
- `npx tsc --noEmit` from crm-dashboard directory passes (no TypeScript errors)
- `npm run build` from crm-dashboard directory succeeds
- Visually inspect ClientAccordion.tsx to confirm:
  - Client interface includes client_type
  - Supabase query selects client_type
  - getNavItems function exists and filters on 'leads_only'
  - Both render paths (single-client and multi-client) use getNavItems
  </verify>
  <done>
Lead interface has has_website and social_media_presence fields. ClientAccordion fetches client_type, and leads-only clients show only the Leads tab in the sidebar.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Visual verification -- Cold Calling in sidebar with leads-only tab</name>
  <what-built>
Cold Calling client added to database as leads-only client. ClientAccordion now filters tabs based on client_type. Lead schema extended with has_website and social_media_presence columns.
  </what-built>
  <how-to-verify>
1. Open the CRM dashboard in your browser (the Vercel deployment should auto-deploy from main, or check localhost if running dev server)
2. Look at the sidebar -- "Cold Calling" should appear in the client list (alphabetically sorted among active clients)
3. Click/expand "Cold Calling" -- you should see ONLY the "Leads" tab (no Orders, Pipeline, Analytics, or Visits)
4. Click/expand any other client (e.g., Shrike Media Website) -- you should see all 5 tabs as before
5. Verify the Leads tab under Cold Calling is clickable and navigates correctly (it will show an empty leads list, which is expected)
  </how-to-verify>
  <resume-signal>Type "approved" if Cold Calling shows only Leads tab and other clients still show all 5 tabs, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
- SQL migration ran successfully (leads table has new columns, clients table has client_type, Cold Calling client exists)
- TypeScript builds without errors
- Cold Calling appears in sidebar with only Leads tab
- All other clients still show all 5 tabs
- No regressions in existing client navigation
</verification>

<success_criteria>
1. User sees "Cold Calling" in sidebar client list as an active client
2. Expanding Cold Calling shows only the Leads tab
3. Expanding any other client shows all 5 tabs (Leads, Orders, Pipeline, Analytics, Visits)
4. leads table has has_website (boolean, nullable) and social_media_presence (integer 1-5, nullable) columns
5. TypeScript Lead interface includes both new fields
6. Application builds and deploys without errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-database-cold-calling-client/06-01-SUMMARY.md`
</output>
