---
phase: 08-edit-lead-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - crm-dashboard/app/(dashboard)/leads/[id]/page.tsx
autonomous: false

must_haves:
  truths:
    - "Lead detail page has an Edit button in the contact info card header"
    - "Clicking Edit turns contact fields into editable inputs"
    - "User can change first_name, last_name, email, phone, preferred_contact, sms_consent, has_website, social_media_presence"
    - "Save persists changes to Supabase and page reflects new values immediately"
    - "Cancel discards changes and returns to read-only view"
    - "A lead_event is logged when fields are edited"
  artifacts:
    - path: "crm-dashboard/app/(dashboard)/leads/[id]/page.tsx"
      provides: "Edit mode toggle with inline form fields and save/cancel"
      contains: "isEditing"
  key_links:
    - from: "crm-dashboard/app/(dashboard)/leads/[id]/page.tsx"
      to: "supabase.from('leads').update(...)"
      via: "saveEdit function"
      pattern: "supabase.*leads.*update"
    - from: "crm-dashboard/app/(dashboard)/leads/[id]/page.tsx"
      to: "supabase.from('lead_events').insert(...)"
      via: "event logging in saveEdit"
      pattern: "lead_events.*insert.*lead_edited"
---

<objective>
Add inline edit capability to the lead detail page contact info card so users can correct manually-entered lead data.

Purpose: Completes the lead management lifecycle (add -> view -> edit) for v1.2 milestone. Users who enter leads via the Add Lead form need a way to fix typos or update info.

Output: Modified lead detail page with Edit/Save/Cancel toggle on the contact info card. When editing, static text fields become inputs. Save writes to Supabase, logs a lead_event, and re-renders with updated data.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# The file being modified — read this first
@crm-dashboard/app/(dashboard)/leads/[id]/page.tsx

# Type definitions for Lead fields
@crm-dashboard/types/lead.ts

# Phase 7 summary — shows Add Lead form patterns (native dialog, field layout, supabase insert)
@.planning/phases/07-manual-lead-entry-ui/07-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add edit mode toggle with inline editable fields and save handler</name>
  <files>crm-dashboard/app/(dashboard)/leads/[id]/page.tsx</files>
  <action>
Add edit/save/cancel functionality to the contact info card in LeadDetailPage. All changes are in this single file.

**State additions:**
- `isEditing` boolean (default false)
- `editForm` object holding editable field values, typed as:
  ```ts
  { first_name: string, last_name: string, email: string, phone: string,
    preferred_contact: 'email' | 'phone' | 'sms', sms_consent: boolean,
    has_website: boolean | null, social_media_presence: number | null }
  ```
- When entering edit mode, initialize `editForm` from current `lead` values

**UI changes to the contact info card (the first bg-white card):**

1. Header row: Add an "Edit" button next to the existing "Delete" button. When `isEditing` is true, show "Save" (blue) and "Cancel" (gray) buttons instead of "Edit".

2. When `isEditing` is false (read-only mode): Keep current display exactly as-is — name in h1, email/phone as links, SMS consent as Yes/No, preferred contact as text, created date as text.

3. When `isEditing` is true (edit mode):
   - Replace the h1 name with two text inputs side by side for first_name and last_name (use same grid layout)
   - Replace email display with a text input
   - Replace phone display with a text input
   - Replace preferred_contact display with three radio buttons: Email, Phone, SMS (follow the same pattern used in Add Lead form from Phase 7 — controlled radios with onChange)
   - Replace SMS consent display with a checkbox
   - Add has_website checkbox (new field, not currently shown in read-only view)
   - Add social_media_presence as 5 radio buttons labeled 1-5 with a "None" option to clear (new field, not currently shown in read-only view)
   - Keep "Created" date as read-only text (not editable)

4. Also display has_website and social_media_presence in read-only mode if they have values (currently not shown at all). Show them after the existing fields in the grid. has_website as "Yes"/"No", social_media_presence as the number or "-".

**Save handler (`saveEdit` function):**
- Follow the exact same pattern as `updateStatus` and `saveNotes`:
  - Set `setSaving(true)`
  - Call `supabase.from('leads').update({ ...editForm }).eq('id', id)`
  - On success, insert a lead_event with `event_type: 'lead_edited'` and `event_data` containing the changed fields only (compare editForm values against current lead values, only include fields that actually changed)
  - Call `fetchLead()` and `fetchEvents()` to refresh
  - Set `setSaving(false)` and `setIsEditing(false)`

**Cancel handler:**
- Set `isEditing` to false. The editForm state is discarded (it will be re-initialized from lead on next Edit click).

**Styling:**
- Input fields: Use the same Tailwind classes as the notes textarea: `w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500`
- Radio buttons: Simple `<input type="radio">` with labels, laid out horizontally with `flex gap-4`
- Checkboxes: `<input type="checkbox">` with label text next to it
- Save button: Same style as Save Notes button (`bg-blue-600 text-white px-4 py-2 rounded-md text-sm hover:bg-blue-700 disabled:opacity-50`)
- Cancel button: `bg-gray-100 text-gray-700 px-4 py-2 rounded-md text-sm hover:bg-gray-200`
- Edit button: `text-blue-600 hover:text-blue-700 text-sm` (matching Delete button style but blue)

**Do NOT:**
- Create separate components or files — keep everything inline in this page (matches existing pattern)
- Add form validation (requirement says all fields optional, this is an admin tool)
- Make UTM/attribution fields editable (system-generated)
- Make status or notes editable here (they already have their own edit mechanisms)
- Make created_at or updated_at editable (system-managed)
  </action>
  <verify>
Run `npx tsc --noEmit` from the crm-dashboard directory to confirm TypeScript compiles. Run `npx next build` to confirm the build succeeds. No new files should be created — only the one page.tsx modified.
  </verify>
  <done>
Lead detail page has Edit/Save/Cancel toggle on contact info card. Edit mode shows input fields for 8 editable fields. Save writes to Supabase and logs a lead_event. Cancel discards changes. Read-only mode shows has_website and social_media_presence when they have values. TypeScript compiles and build succeeds.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of edit functionality</name>
  <what-built>Edit mode on lead detail page — inline editing of contact fields with save/cancel</what-built>
  <how-to-verify>
    1. Navigate to any lead detail page
    2. Confirm "Edit" button appears next to "Delete" in the contact info card header
    3. Click "Edit" — fields should become editable inputs
    4. Confirm all 8 fields are editable: first name, last name, email, phone, preferred contact (radios), SMS consent (checkbox), has_website (checkbox), social_media_presence (1-5 radios)
    5. Change one or more fields and click "Save" — page should return to read-only view with updated values
    6. Check the Activity timeline sidebar — a "lead edited" event should appear with the changed fields
    7. Refresh the page — changes should persist
    8. Click "Edit" again, make changes, then click "Cancel" — changes should be discarded, original values shown
    9. Verify has_website and social_media_presence show in read-only mode if they have values
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
- TypeScript compiles without errors (`npx tsc --noEmit`)
- Next.js build succeeds (`npx next build`)
- Only one file modified: `crm-dashboard/app/(dashboard)/leads/[id]/page.tsx`
- No new dependencies added
</verification>

<success_criteria>
- Lead detail page has Edit button that toggles contact fields to editable inputs
- Save persists all 8 editable fields to Supabase
- A lead_event with type 'lead_edited' is logged on save with only changed fields
- Cancel discards changes without saving
- has_website and social_media_presence visible in read-only mode when populated
- Existing functionality (status buttons, notes, delete, orders, UTM) unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/08-edit-lead-ui/08-01-SUMMARY.md`
</output>
